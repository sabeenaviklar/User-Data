import{jsx as t,jsxs as o,Fragment as e}from"react/jsx-runtime";import{useState as i,useCallback as n,useEffect as r,memo as s,useRef as c}from"react";import{Box as d,IconButton as l,Button as a,TableRow as m,TableCell as v,TableContainer as u,Table as p,TableHead as f,TableSortLabel as h,TableBody as x,LinearProgress as w}from"@mui/material";import{dequal as y}from"dequal";import{useCustomCompareEffect as g}from"use-custom-compare";import{Virtuoso as S}from"react-virtuoso";import b from"zustand";import C from"zustand/context";import D from"immer";import z from"@mui/icons-material/Add";import R from"@mui/icons-material/Remove";import j from"@mui/icons-material/ImportExport";import{CSVLink as k}from"react-csv";import B from"@mui/icons-material/Visibility";import{createNewSortInstance as I}from"fast-sort";const{Provider:T,useStore:O,useStoreApi:F}=C(),M=()=>{return b((t=t=>({state:{rows:[],orgRows:[],fontSize:1,sortDirection:!1,sortBy:""},actions:{setFontSize:o=>t((t=>{t.state.fontSize=o(t.state.fontSize)})),setSortDirection:()=>t((t=>{t.state.sortDirection=!t.state.sortDirection})),setSortBy:o=>t((t=>{t.state.sortBy=o})),setRows:o=>t((t=>{t.state.rows=o})),setOrgRows:o=>t((t=>{t.state.orgRows=o}))}}),(o,e,i)=>t(((t,e)=>{const i="function"==typeof t?D(t):t;return o(i,e)}),e,i)));var t};function A({children:o}){return t(T,{createStore:M,children:o},void 0)}const E=O,q=F;function G(){const{setFontSize:e}=E((t=>t.actions));return o(d,{sx:{display:"flex",justifyContent:"space-around",alignItems:"center"},children:[t(l,{onClick:()=>{e((t=>t+.1))},children:t(z,{},void 0)},void 0),t(l,{onClick:()=>{e((t=>t-.1))},children:t(R,{},void 0)},void 0)]},void 0)}function L(){const o=E((t=>t.state.rows));return t(d,{children:t(k,{data:o,filename:"data-table-export",style:{textDecoration:"none"},children:t(a,{variant:"text",endIcon:t(j,{},void 0),color:"primary",children:"Export"},void 0)},void 0)},void 0)}function N(){const{setSortBy:o,setRows:e,setFontSize:i}=E((t=>t.actions)),{getState:n}=q();return t(l,{onClick:()=>{o(""),i((()=>1));const t=n().state.orgRows;!t||t.length<1||e(t)},children:t(B,{},void 0)},void 0)}const P={cursor:"pointer",color:"#1b4394"};function V(s){const{lines:c=3,obj:d,lessText:l="Less",moreText:a="More"}=s,[m,v]=i(""),[u,p]=i(!0),[f,h]=i(null),x=n((t=>{if(!t)return;t.getClientRects().length<=c||h(Math.ceil(t.innerText.length/c))}),[c]);return r((()=>(W(d)&&v(d),()=>h(null))),[d]),m?o("span",{ref:x,children:[u&&f?m.substring(0,f):m,t("span",{onClick:()=>p((t=>!t)),style:P,children:f&&t(e,{children:u?"... "+a:" "+l},void 0)},void 0)]},void 0):d}const W=t=>"[object String]"===Object.prototype.toString.call(t),$=o=>{const{columns:i,row:n,index:r,truncate:s}=o,c=E((t=>t.state.fontSize)),d=(o,i)=>{const s=(null==n?void 0:n[o])?String(n[o]):"";return i?t(e,{children:i({index:r,value:s,row:n})},void 0):s};return t("div",{style:{width:"100%",height:"100%"},children:t(m,{sx:{display:"flex"},component:"div",hover:!0,children:i.map((({field:o,flex:i,width:n,renderCell:r},l)=>t(v,{component:"div",sx:{flex:n||i?i:1,width:n,wordBreak:"break-word"},children:t("div",{style:{fontSize:`${c}em`},children:s?t(V,{obj:d(o,r),...s},void 0):t(e,{children:d(o,r)},void 0)},void 0)},l)))},void 0)},void 0)},H=I({comparer:new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare}),J={width:"100%",height:"100%"},K=s((e=>{const{columns:i,rows:n,component:r,loading:s,sx:l,overscanCount:a=0,truncateText:w}=e,{rows:b,sortBy:C,sortDirection:D}=E((t=>t.state)),{setOrgRows:z,setRows:R,setSortBy:j,setSortDirection:k}=E((t=>t.actions)),B=c(null);g((()=>{R(n),z(n)}),[n],y);return o(d,{component:null!=r?r:"div",sx:{...J,display:"flex",flexDirection:"column"},children:[t(Q,{},void 0),t(u,{sx:J,component:null!=r?r:"div",children:t(p,{sx:{display:"flex",flexDirection:"column",...J,...l},component:"div",children:o(d,{sx:{...J,minWidth:"max-content",display:"flex",flexDirection:"column"},children:[t(f,{component:"div",children:t(m,{sx:{display:"flex"},component:"div",children:i.map((({field:o,flex:e,width:i,headerName:r})=>t(v,{sx:{flex:i||e?e:1,width:i,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},component:"div",children:t(h,{active:C===o,direction:D?"asc":"desc",onClick:()=>{((t,o)=>{var e;j(o),R(t?H(n).asc((t=>t[o])):H(n).desc((t=>t[o]))),null===(e=B.current)||void 0===e||e.scrollToIndex({index:0})})(!D,o),k()},children:String(r)},void 0)},o)))},void 0)},void 0),o(x,{sx:{...J,position:"relative"},component:"div",children:[s&&t(U,{},void 0),t(S,{height:"100%",width:"100%",ref:B,data:n.length!==b.length?n:b,overscan:a,itemContent:(o,e)=>t($,{columns:i,row:e,index:o,truncate:w},void 0)},void 0)]},void 0)]},void 0)},void 0)},void 0)]},void 0)}),y);function Q(){return o(d,{sx:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",p:"5px"},children:[t(L,{},void 0),t(G,{},void 0),t(N,{},void 0)]},void 0)}function U(){return t(w,{sx:{position:"absolute",top:"0px",width:"100%"}},void 0)}function X({...o}){return t(A,{children:t(K,{...o},void 0)},void 0)}export{X as MuiDataGrid};
